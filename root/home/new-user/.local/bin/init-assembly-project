#!/bin/bash

if [ -z "$1" ]; then
  echo "Usage: $0 <project_name>"
  exit 1
fi

PROJECT_NAME=$1
PROJECT_DIR="$PWD/$PROJECT_NAME"

if [ -d "$PROJECT_DIR" ]; then
  echo "Error: Directory '$PROJECT_NAME' already exists."
  exit 1
fi

mkdir -p "$PROJECT_DIR"
cd "$PROJECT_DIR" || exit 1

# Create main.c
cat <<EOF > main.c
#include <stdio.h>

extern int asm_func(void);

int main() {
    printf("Calling assembly function...\\n");
    int result = asm_func();
    printf("Result: %d\\n", result);
    return 0;
}
EOF

# Create functions.s
cat <<EOF > functions.s
.global asm_func

asm_func:
mov x0, #0
ret
EOF

# Create Makefile
cat <<EOF > Makefile
CC = aarch64-linux-gnu-gcc
CFLAGS = -Wall -g
LDFLAGS = -static

OBJS = main.o functions.o

all: main

main: \$(OBJS)
	\$(CC) \$(LDFLAGS) -o \$@ \$^

main.o: main.c
	\$(CC) \$(CFLAGS) -c -o \$@ \$<

functions.o: functions.s
	\$(CC) \$(CFLAGS) -c -o \$@ \$<

clean:
	rm -f main \$(OBJS)

run: main
	qemu-aarch64 ./main
EOF

echo "Project '$PROJECT_NAME' created successfully in $PROJECT_DIR"
echo "To build and run:"
echo "  cd $PROJECT_NAME"
echo "  make run"
