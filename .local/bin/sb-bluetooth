#!/bin/sh

# Usage: sb-bluetooth MAC
# Example: sb-bluetooth "3C:B0:ED:A7:6A:88"

MAC="${1:-}"

if [ -z "$MAC" ]; then
    exit 0
fi

# Check if the device is connected (with timeout)
connected=$(timeout 2 bluetoothctl info "$MAC" 2>/dev/null | awk '/Connected:/ {print $2}')

if [ "$connected" = "yes" ]; then
    # Get battery percentage (with timeout)
    battery=$(timeout 2 bluetoothctl info "$MAC" 2>/dev/null | grep "Battery Percentage" | grep -oP '\(\K[0-9]+')
    if [ -n "$battery" ]; then
        echo "ðŸŽ§ ${battery}%"
    else
        echo "ðŸŽ§ --"
    fi
else
    # Don't show anything when not connected
    echo ""
fi
