#!/bin/sh

# Get actual battery device (BAT0)
BAT=$(upower -e 2>/dev/null | grep 'battery_BAT0$')

# If no battery found, don't show anything
if [ -z "$BAT" ]; then
    echo ""
    exit 0
fi

# Battery percentage (e.g. "0.363322%")
RAW=$(upower -i "$BAT" 2>/dev/null | awk '/percentage/ {print $2}')

# If no percentage found, don't show anything
if [ -z "$RAW" ]; then
    echo ""
    exit 0
fi

# Remove % sign
NUM=${RAW%\%}

# Validate NUM is a number
if ! echo "$NUM" | grep -qE '^[0-9]+\.?[0-9]*$'; then
    echo ""
    exit 0
fi

# If number < 1, force to 1%
if awk "BEGIN { exit !($NUM < 1) }"; then
    PERC="1%"
else
    PERC="$RAW"
fi

# Get AC adapter device
AC=$(upower -e 2>/dev/null | grep 'line_power')
ONLINE=$(upower -i "$AC" 2>/dev/null | awk '/online/ {print $2}')

# Show âš¡ when AC plugged, ðŸ”‹ when not
if [ "$ONLINE" = "yes" ]; then
    echo "âš¡ $PERC"
else
    echo "ðŸ”‹ $PERC"
fi
