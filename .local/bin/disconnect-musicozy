#!/bin/bash
MAC="41:42:AB:DD:51:37"

# Ask bluez to disconnect
bluetoothctl disconnect "$MAC"

# Wait (with timeout) for bluez to report Connected: no
TIMEOUT=10   # seconds
WAITED=0
INTERVAL=0.2

while bluetoothctl info "$MAC" 2>/dev/null | grep -q "Connected: yes"; do
    sleep $INTERVAL
    WAITED=$(awk "BEGIN {print $WAITED + $INTERVAL}")
    if (( $(echo "$WAITED >= $TIMEOUT" | bc -l) )); then
        echo "Timeout waiting for device to disconnect"
        break
    fi
done

pkill -RTMIN+5 dwmblocks # refresh headphones
pkill -RTMIN+4 dwmblocks # refresh volume
