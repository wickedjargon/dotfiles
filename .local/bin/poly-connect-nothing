#!/bin/bash

# Connect Nothing Headphone (1) and set as default audio output

MAC="3C:B0:ED:A7:6A:88"
SINK="bluez_sink.3C_B0_ED_A7_6A_88.a2dp_sink"

# Connect via bluetoothctl
echo -e "connect $MAC\nexit" | bluetoothctl

# Wait for the sink to appear
for i in {1..10}; do
    if pactl list short sinks | grep -q "$SINK"; then
        break
    fi
    sleep 0.5
done

# Set default sink
pactl set-default-sink "$SINK"

# Move all current audio streams to headphones
for stream in $(pactl list short sink-inputs | awk '{print $1}'); do
    pactl move-sink-input "$stream" "$SINK"
done

echo "Headphones connected and set as default."

sleep 0.5

# Trigger polybar module updates
polybar-msg hook headphones 1 >/dev/null 2>&1
polybar-msg hook pulseaudio 1 >/dev/null 2>&1
